<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>Document</title>
    <link
      rel="stylesheet"
      href="./@capsule/global.css"
    />
    <script src="./@capsule/utils/ripple.js"></script>
    <script
      type="module"
      src="./@capsule/components/init.js"
    ></script>
  </head>
  <body>
    <capsule-button variant="primary"> ัะตัั </capsule-button>

    <capsule-skeleton variant="rectangular"></capsule-skeleton>

    <form id="form">
      <form-field>
        <capsule-rating
          max="5"
          precision="0.1"
          color="primary"
          name="rating"
        >
          <span slot="star-1-empty">๐ด</span>
          <span slot="star-1-filled">๐</span>
          <span slot="star-2-empty">๐ด</span>
          <span slot="star-2-filled">๐</span>
        </capsule-rating>
        <form-message></form-message>
      </form-field>

      <form-field>
        <capsule-slider name="price"></capsule-slider>
        <form-message></form-message>
      </form-field>

      <capsule-button type="submit"> Submit </capsule-button>
    </form>

    <script
      defer
      type="module"
    >
      import { CapsuleValidator } from '../src/modules/form/validator.js';
      import { CapsuleRules } from '../src/modules/form/rules.js';

      class FormField extends HTMLElement {
        constructor() {
          super();
        }

        setError(message, selector = 'form-message') {
          const messageElement = this.querySelector(selector);
          if (messageElement) {
            if (message) {
              if (typeof messageElement.setMessage === 'function') {
                messageElement.setMessage(message);
              } else {
                messageElement.textContent = message;
                messageElement.style.display = 'block';
              }
              this.classList.add('error');
            } else {
              if (typeof messageElement.clearMessage === 'function') {
                messageElement.clearMessage();
              } else {
                messageElement.textContent = '';
                messageElement.style.display = 'none';
              }
              this.classList.remove('error');
            }
          }
        }
      }
      customElements.define('form-field', FormField);
      class FormMessage extends HTMLElement {
        constructor() {
          super();
        }

        connectedCallback() {
          this.style.display = 'none';
        }

        setMessage(message) {
          this.textContent = message;
          this.style.display = 'block';
        }

        clearMessage() {
          this.textContent = '';
          this.style.display = 'none';
        }
      }

      customElements.define('form-message', FormMessage);

      const standardValidator = new CapsuleValidator('#form', {
        fields: {
          rating: [CapsuleRules.required(), CapsuleRules.minValue(3)],
          price: [CapsuleRules.arrayMax(2)],
        },
        validateOnInput: true,
        validateOnChange: true,

        onSubmit: (e) => {
          console.log(e);
        },
      });
    </script>
  </body>
</html>
